

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>procedures.proc &mdash; Psi4 [1.0.0 6a9a71b] Docs</title>
    
    <link rel="stylesheet" href="../../_static/psi4.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0 6a9a71b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../_static/toggle_sections.js"></script>
    <script type="text/javascript" src="../../_static/toggle_sidebar.js"></script>
    <script type="text/javascript" src="../../_static/toggle_codeprompt.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon-psi4.ico"/>
    <link rel="top" title="Psi4 [1.0.0 6a9a71b] Docs" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../contents.html" title="Table Of Contents"
             accesskey="C">toc</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Psi4 [1.0.0 6a9a71b]</a> &raquo; </li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for procedures.proc</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># @BEGIN LICENSE</span>
<span class="c1">#</span>
<span class="c1"># Psi4: an open-source quantum chemistry software package</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2007-2016 The Psi4 Developers.</span>
<span class="c1">#</span>
<span class="c1"># The copyrights for code used from other parties are included in</span>
<span class="c1"># the corresponding files.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="c1">#</span>
<span class="c1"># @END LICENSE</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;Module with functions that encode the sequence of PSI module</span>
<span class="sd">calls for each of the *name* values of the energy(), optimize(),</span>
<span class="sd">response(), and frequency() function. *name* can be assumed lowercase by here.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># Relative hack for now</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">inspect</span>
<span class="n">path_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span> <span class="p">))[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;../&quot;</span><span class="p">)))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path_dir</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">p4util</span>
<span class="kn">from</span> <span class="nn">p4util.exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">molutil</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">.functional</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.roa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">proc_util</span>

<span class="c1"># never import driver, wrappers, or aliases into this file</span>

<span class="c1"># ATTN NEW ADDITIONS!</span>
<span class="c1"># consult http://psicode.org/psi4manual/master/proc_py.html</span>

<div class="viewcode-block" id="select_mp2"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp2">[docs]</a><span class="k">def</span> <span class="nf">select_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP2 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/dfmp2/detci/fnocc</span>

    <span class="c1"># MP2_TYPE exists largely for py-side reasoning, so must manage it</span>
    <span class="c1">#   here rather than passing to c-side unprepared for validation</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp2&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp2_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp2_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_mp2_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP2 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/dfmp2</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2_gradient</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp2_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp2_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp2_property">[docs]</a><span class="k">def</span> <span class="nf">select_mp2_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP2 property call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only dfmp2 for now</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="c1">#if module == &#39;OCC&#39;:</span>
            <span class="c1">#    func = run_dfocc_property</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DFMP2&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfmp2_property</span>
    <span class="c1">#elif reference == &#39;UHF&#39;:</span>
    <span class="c1">#    if mtd_type == &#39;DF&#39;:</span>
    <span class="c1">#        if module in [&#39;&#39;, &#39;OCC&#39;]:</span>
    <span class="c1">#            func = run_dfocc_property</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp2_property&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp2"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp2">[docs]</a><span class="k">def</span> <span class="nf">select_omp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP2 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp2&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp2_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp2_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_omp2_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP2 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp2_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp2_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp2_property">[docs]</a><span class="k">def</span> <span class="nf">select_omp2_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP2 property call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_property</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp2_property&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp3"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp3">[docs]</a><span class="k">def</span> <span class="nf">select_mp3</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP3 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/fnocc/detci</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>  <span class="c1"># no default for this case</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">This method is available inefficiently as a &quot;&quot;&quot;</span>
                               <span class="sd">&quot;&quot;&quot;byproduct of a CISD computation.\n  Add &quot;set &quot;&quot;&quot;</span>
                               <span class="sd">&quot;&quot;&quot;qc_module detci&quot; to input to access this route.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp3&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp3_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp3_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_mp3_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP3 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp3_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp3"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp3">[docs]</a><span class="k">def</span> <span class="nf">select_omp3</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP3 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp3&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp3_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp3_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_omp3_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP3 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp3_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp2p5"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp2p5">[docs]</a><span class="k">def</span> <span class="nf">select_mp2p5</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP2.5 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp2p5&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp2p5_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp2p5_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_mp2p5_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP2.5 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp2p5_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp2p5"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp2p5">[docs]</a><span class="k">def</span> <span class="nf">select_omp2p5</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP2.5 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp2p5&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_omp2p5_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_omp2p5_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_omp2p5_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OMP2.5 gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_omp2p5_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_lccd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_lccd">[docs]</a><span class="k">def</span> <span class="nf">select_lccd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a LCCD energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_cepa</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_lccd&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="select_lccd_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_lccd_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_lccd_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a LCCD gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_lccd_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_olccd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_olccd">[docs]</a><span class="k">def</span> <span class="nf">select_olccd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OLCCD energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_olccd&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_olccd_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_olccd_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_olccd_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for an OLCCD gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_occ_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_olccd_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_fnoccsd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_fnoccsd">[docs]</a><span class="k">def</span> <span class="nf">select_fnoccsd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a FNO-CCSD energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_fnoccsd&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_ccsd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_ccsd">[docs]</a><span class="k">def</span> <span class="nf">select_ccsd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CCSD energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/ccenergy/detci/fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_ccsd&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_ccsd_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_ccsd_gradient">[docs]</a><span class="k">def</span> <span class="nf">select_ccsd_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CCSD gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/ccenergy</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy_gradient</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc_gradient</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy_gradient</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_ccsd_gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_fnoccsd_t_"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_fnoccsd_t_">[docs]</a><span class="k">def</span> <span class="nf">select_fnoccsd_t_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a FNO-CCSD(T) energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_fnoccsd_t_&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_ccsd_t_"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_ccsd_t_">[docs]</a><span class="k">def</span> <span class="nf">select_ccsd_t_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CCSD(T) energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/ccenergy/fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;OCC&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnodfcc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_ccsd_t_&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_ccsd_t__gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_ccsd_t__gradient">[docs]</a><span class="k">def</span> <span class="nf">select_ccsd_t__gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CCSD(T) gradient call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only ccenergy</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy_gradient</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_ccsd_t__gradient&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_ccsd_at_"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_ccsd_at_">[docs]</a><span class="k">def</span> <span class="nf">select_ccsd_at_</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CCSD(AT) energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only [df]occ/ccenergy</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;CCENERGY&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_ccenergy</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>
        <span class="k">elif</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;OCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_dfocc</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_ccsd_at_&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CC_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_cisd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_cisd">[docs]</a><span class="k">def</span> <span class="nf">select_cisd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a CISD energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;CI_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only detci/fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_cepa</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_cisd&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;CI_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="select_mp4"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.select_mp4">[docs]</a><span class="k">def</span> <span class="nf">select_mp4</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function selecting the algorithm for a MP4 energy call</span>
<span class="sd">    and directing to specified or best-performance default modules.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="n">mtd_type</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;QC_MODULE&#39;</span><span class="p">)</span>
    <span class="c1"># Considering only detci/fnocc</span>

    <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;FNOCC&#39;</span><span class="p">]:</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_fnocc</span>
    <span class="k">elif</span> <span class="n">reference</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mtd_type</span> <span class="o">==</span> <span class="s1">&#39;CONV&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">module</span> <span class="o">==</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">:</span>  <span class="c1"># no default for this case</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">run_detci</span>
            <span class="k">elif</span> <span class="n">module</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">This method is available inefficiently as a &quot;&quot;&quot;</span>
                               <span class="sd">&quot;&quot;&quot;byproduct of a CISDT computation.\n  Add &quot;set &quot;&quot;&quot;</span>
                               <span class="sd">&quot;&quot;&quot;qc_module detci&quot; to input to access this route.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ManagedMethodError</span><span class="p">([</span><span class="s1">&#39;select_mp4&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;MP_TYPE&#39;</span><span class="p">,</span> <span class="n">mtd_type</span><span class="p">,</span> <span class="n">reference</span><span class="p">,</span> <span class="n">module</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;probe&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="scf_helper"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.scf_helper">[docs]</a><span class="k">def</span> <span class="nf">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function serving as helper to SCF, choosing whether to cast</span>
<span class="sd">    up or just run SCF with a standard guess. This preserves</span>
<span class="sd">    previous SCF options set by other procedures (e.g., SAPT</span>
<span class="sd">    output file types for SCF).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;PUREAM&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;QMEFP&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">]</span>  <span class="c1"># Hack: scope gets changed internally with the Andy trick</span>
    <span class="p">)</span>

    <span class="n">optstash2</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;BASIS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">])</span>

    <span class="c1"># Grab a few kwargs</span>
    <span class="n">use_c1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_c1&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">scf_molecule</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;ref_wfn&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;It is not possible to pass scf_helper a reference wavefunction&quot;</span><span class="p">)</span>

    <span class="c1"># Second-order SCF requires non-symmetric density matrix support</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SOSCF&#39;</span><span class="p">):</span>
        <span class="n">proc_util</span><span class="o">.</span><span class="n">check_non_symmetric_jk_density</span><span class="p">(</span><span class="s2">&quot;Second-order SCF&quot;</span><span class="p">)</span>

    <span class="c1"># sort out cast_up settings. no need to stash these since only read, never reset</span>
    <span class="n">cast</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;BASIS_GUESS&#39;</span><span class="p">):</span>
        <span class="n">cast</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;BASIS_GUESS&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cast</span><span class="p">)):</span>
            <span class="n">cast</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">no</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cast</span><span class="p">)):</span>
            <span class="n">cast</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="n">castdf</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">castdf</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_GUESS&#39;</span><span class="p">):</span>
            <span class="n">castdf</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_GUESS&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">castdf</span><span class="p">)):</span>
                <span class="n">castdf</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">no</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">castdf</span><span class="p">)):</span>
                <span class="n">castdf</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1"># sort out broken_symmetry settings.</span>
    <span class="k">if</span> <span class="s1">&#39;brokensymmetry&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">multp</span> <span class="o">=</span> <span class="n">scf_molecule</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">multp</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Broken symmetry is only for singlets.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;You must specify &#39;set reference uhf&#39; to use broken symmetry.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">do_broken</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">do_broken</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">precallback</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s1">&#39;precallback&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">precallback</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;precallback&#39;</span><span class="p">)</span>

    <span class="n">postcallback</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s1">&#39;postcallback&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">postcallback</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;postcallback&#39;</span><span class="p">)</span>

    <span class="c1"># Hack to ensure cartesian or pure are used throughout</span>
    <span class="c1"># Note that can&#39;t query PUREAM option directly, as it only</span>
    <span class="c1">#   reflects user changes to value, so load basis and</span>
    <span class="c1">#   read effective PUREAM setting off of it</span>
    <span class="c1">#psi4.set_global_option(&#39;BASIS&#39;, psi4.get_global_option(&#39;BASIS&#39;))</span>
    <span class="c1">#psi4.set_global_option(&#39;PUREAM&#39;, psi4.MintsHelper().basisset().has_puream())</span>

    <span class="c1"># broken set-up</span>
    <span class="k">if</span> <span class="n">do_broken</span><span class="p">:</span>
        <span class="n">scf_molecule</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;  Computing high-spin triplet guess  &#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># cast set-up</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cast</span><span class="p">)):</span>
            <span class="n">guessbasis</span> <span class="o">=</span> <span class="s1">&#39;3-21G&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">guessbasis</span> <span class="o">=</span> <span class="n">cast</span>

        <span class="c1">#if (castdf):</span>
        <span class="c1">#    if yes.match(str(castdf)):</span>
        <span class="c1">#        guessbasisdf = p4util.corresponding_jkfit(guessbasis)</span>
        <span class="c1">#    else:</span>
        <span class="c1">#        guessbasisdf = castdf</span>

        <span class="c1"># Switch to the guess namespace</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">get_default_namespace</span><span class="p">()</span>
        <span class="n">guesspace</span> <span class="o">=</span> <span class="n">namespace</span> <span class="o">+</span> <span class="s1">&#39;.guess&#39;</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">guesspace</span> <span class="o">=</span> <span class="s1">&#39;guess&#39;</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="n">guesspace</span><span class="p">)</span>

        <span class="c1"># Setup initial SCF</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">,</span> <span class="n">guessbasis</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">castdf</span><span class="p">):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="c1">#psi4.set_global_option(&#39;DF_BASIS_SCF&#39;, guessbasisdf)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">yes</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">castdf</span><span class="p">)):</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">,</span> <span class="n">castdf</span><span class="p">)</span>

        <span class="c1"># Print some info about the guess</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Guess SCF, </span><span class="si">%s</span><span class="s1"> Basis&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">guessbasis</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="c1"># If we force c1 copy the active molecule</span>
    <span class="k">if</span> <span class="n">use_c1</span><span class="p">:</span>
        <span class="n">scf_molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scf_molecule</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  A requested method does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                           <span class="sd">&quot;&quot;&quot;further calculations in C1 point group.\n&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="n">scf_molecule</span> <span class="o">=</span> <span class="n">scf_molecule</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">scf_molecule</span><span class="o">.</span><span class="n">reset_point_group</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
            <span class="n">scf_molecule</span><span class="o">.</span><span class="n">fix_orientation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">scf_molecule</span><span class="o">.</span><span class="n">fix_com</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">scf_molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

    <span class="c1"># the FIRST scf call</span>
    <span class="k">if</span> <span class="n">cast</span> <span class="ow">or</span> <span class="n">do_broken</span><span class="p">:</span>
        <span class="c1"># Cast or broken are special cases</span>
        <span class="n">new_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">new_wavefunction</span><span class="p">(</span><span class="n">scf_molecule</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">new_wfn</span><span class="p">,</span> <span class="n">precallback</span><span class="p">,</span> <span class="n">postcallback</span><span class="p">)</span>

    <span class="c1"># broken clean-up</span>
    <span class="k">if</span> <span class="n">do_broken</span><span class="p">:</span>
        <span class="n">scf_molecule</span><span class="o">.</span><span class="n">set_multiplicity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s1">&#39;READ&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;  Computing broken symmetry solution from high-spin triplet guess  &#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># cast clean-up</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cast</span><span class="p">):</span>

        <span class="c1"># Move files to proper namespace</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="n">guesspace</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

        <span class="c1"># Set to read and project, and reset bases to final ones</span>
        <span class="n">optstash2</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s1">&#39;READ&#39;</span><span class="p">)</span>

        <span class="c1"># Print the banner for the standard operation</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># If GUESS is auto guess what it should be</span>
    <span class="k">elif</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;AUTO&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">((</span><span class="n">scf_molecule</span><span class="o">.</span><span class="n">natom</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SAD_FRAC_OCC&#39;</span><span class="p">)):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s1">&#39;SAD&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROKS&#39;</span><span class="p">,</span> <span class="s1">&#39;UHF&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">]:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s1">&#39;GWH&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;GUESS&#39;</span><span class="p">,</span> <span class="s1">&#39;CORE&#39;</span><span class="p">)</span>
        

    <span class="c1"># EFP preparation</span>
    <span class="n">efp</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_efp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">efp</span><span class="o">.</span><span class="n">nfragments</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_legacy_molecule</span><span class="p">(</span><span class="n">scf_molecule</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;QMEFP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>  <span class="c1"># apt to go haywire if set locally to efp</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">efp_set_options</span><span class="p">()</span>
        <span class="n">efp</span><span class="o">.</span><span class="n">set_qm_atoms</span><span class="p">()</span>
        <span class="n">efp</span><span class="o">.</span><span class="n">print_out</span><span class="p">()</span>

    <span class="c1"># the SECOND scf call</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">new_wavefunction</span><span class="p">(</span><span class="n">scf_molecule</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">))</span>
    <span class="n">scf_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">scf</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">,</span> <span class="n">precallback</span><span class="p">,</span> <span class="n">postcallback</span><span class="p">)</span>
    <span class="n">e_scf</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">)</span>

    <span class="c1"># We always would like to print a little dipole information</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scf_do_dipole&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">):</span>
        <span class="n">oeprop</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">scf_wfn</span><span class="p">)</span>
        <span class="n">oeprop</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;SCF&quot;</span><span class="p">)</span>
        <span class="n">oeprop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;DIPOLE&quot;</span><span class="p">)</span>
        <span class="n">oeprop</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE X&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;SCF DIPOLE X&quot;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE Y&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;SCF DIPOLE Y&quot;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE Z&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;SCF DIPOLE Z&quot;</span><span class="p">))</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scf_wfn</span></div>


<div class="viewcode-block" id="run_dcft"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dcft">[docs]</a><span class="k">def</span> <span class="nf">run_dcft</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density cumulant functional theory calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;FREEZE_CORE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Frozen core is not available for DCFT.&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">dcft_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dcft</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dcft_wfn</span></div>


<div class="viewcode-block" id="run_dcft_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dcft_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_dcft_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    DCFT gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;GLOBALS&#39;</span><span class="p">,</span> <span class="s1">&#39;DERTYPE&#39;</span><span class="p">])</span>


    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRST&#39;</span><span class="p">)</span>
    <span class="n">dcft_wfn</span> <span class="o">=</span> <span class="n">run_dcft</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">derivobj</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">Deriv</span><span class="p">(</span><span class="n">dcft_wfn</span><span class="p">)</span>
    <span class="n">derivobj</span><span class="o">.</span><span class="n">set_tpdm_presorted</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">derivobj</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">dcft_wfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dcft_wfn</span></div>


<div class="viewcode-block" id="run_dfocc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfocc">[docs]</a><span class="k">def</span> <span class="nf">run_dfocc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted or Cholesky-decomposed</span>
<span class="sd">    (non-)orbital-optimized MPN or CC computation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;READ_SCF_3INDEX&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CHOLESKY&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_LAMBDA&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_cholesky_from</span><span class="p">(</span><span class="n">mtd_type</span><span class="p">):</span>
        <span class="n">type_val</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="n">mtd_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CHOLESKY&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
            <span class="c1"># Alter default algorithm</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CHOLESKY&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
            <span class="c1"># Alter default algorithm</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">)</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to CD.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;READ_SCF_3INDEX&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Invalid type &#39;</span><span class="si">%s</span><span class="s2">&#39; for DFOCC&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">type_val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP2&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;MP2_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP2.5&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;omp3&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP3&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;MP_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lccd&#39;</span><span class="p">,</span> <span class="s1">&#39;olccd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OLCCD&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCD&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCSD&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCSD(T)&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(at)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_LAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCSD(AT)&#39;</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dfocc&#39;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Unidentified method </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># conventional vs. optimized orbitals</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;mp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;lccd&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ccd&#39;</span><span class="p">,</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">,</span> <span class="s1">&#39;ccsd(at)&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;omp2&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;omp3&#39;</span><span class="p">,</span> <span class="s1">&#39;olccd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  DFOCC does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;reference wavefunction must be C1.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>
    <span class="n">dfocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfocc_wfn</span></div>


<div class="viewcode-block" id="run_dfocc_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfocc_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_dfocc_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted (non-)orbital-optimized MPN or CC computation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;REFERENCE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_LAMBDA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;GLOBALS&#39;</span><span class="p">,</span> <span class="s1">&#39;DERTYPE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;DFOCC gradients need DF-HF reference, for now.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP2.5&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;omp3&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP3&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lccd&#39;</span><span class="p">,</span> <span class="s1">&#39;olccd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OLCCD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ccd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_LAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ccsd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_LAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Unidentified method </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;mp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;lccd&#39;</span><span class="p">,</span> <span class="s1">&#39;ccd&#39;</span><span class="p">,</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;omp2&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;omp3&#39;</span><span class="p">,</span> <span class="s1">&#39;olccd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRST&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  DFOCC does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;reference wavefunction must be C1.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>
    <span class="n">dfocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfocc_wfn</span></div>


<div class="viewcode-block" id="run_dfocc_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfocc_property">[docs]</a><span class="k">def</span> <span class="nf">run_dfocc_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted (non-)orbital-optimized MPN or CC computation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;OEPROP&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;omp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF-OMP2&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Unidentified method &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;DFOCC gradients need DF-HF reference, for now.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;omp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;OEPROP&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  DFOCC does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;reference wavefunction must be C1.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>
    <span class="n">dfocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfocc_wfn</span></div>


<div class="viewcode-block" id="run_qchf"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_qchf">[docs]</a><span class="k">def</span> <span class="nf">run_qchf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an density-fitted orbital-optimized MP2 computation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DIE_IF_NOT_CONVERGED&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;MAXITER&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;QCHF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;QCHF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;QCHF&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DIE_IF_NOT_CONVERGED&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;MAXITER&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  QCHF does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;reference wavefunction must be C1.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>
    <span class="n">dfocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dfocc_wfn</span></div>


<div class="viewcode-block" id="run_occ"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_occ">[docs]</a><span class="k">def</span> <span class="nf">run_occ</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a conventional integral (O)MPN computation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;omp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-omp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs(n)-omp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCSN&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-omp2-vdw&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCSVDW&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sos-omp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sos-pi-omp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SOSPI&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2.5&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2.5&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2.5&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs(n)-omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCSN&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-omp3-vdw&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SCS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SCSVDW&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sos-omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sos-pi-omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;SOS_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;SOSPI&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCEPA&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;olccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCEPA&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Invalid method </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>

    <span class="n">occ_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">occ</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">occ_wfn</span></div>


<div class="viewcode-block" id="run_occ_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_occ_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_occ_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a conventional integral (O)MPN computation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;GLOBALS&#39;</span><span class="p">,</span> <span class="s1">&#39;DERTYPE&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;omp2&#39;</span><span class="p">,</span> <span class="s1">&#39;conv-omp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2.5&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2.5&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;omp2.5&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP2.5&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;omp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OMP3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;lccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCEPA&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;olccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;OCEPA&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ORB_OPT&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Invalid method </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="c1"># locking out SCS through explicit keyword setting</span>
    <span class="c1"># * so that current energy must match call</span>
    <span class="c1"># * since grads not avail for scs</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SCS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;OCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_SOS&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>

    <span class="n">occ_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">occ</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">derivobj</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">Deriv</span><span class="p">(</span><span class="n">occ_wfn</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">derivobj</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">occ_wfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">occ_wfn</span></div>


<div class="viewcode-block" id="run_scf"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_scf">[docs]</a><span class="k">def</span> <span class="nf">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a self-consistent-field theory (HF &amp; DFT) calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optstash</span> <span class="o">=</span> <span class="n">proc_util</span><span class="o">.</span><span class="n">scf_set_reference_local</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">scf_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scf_wfn</span></div>


<div class="viewcode-block" id="run_scf_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_scf_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_scf_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a SCF gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">proc_util</span><span class="o">.</span><span class="n">scf_set_reference_local</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ROHF&#39;</span><span class="p">,</span> <span class="s1">&#39;CUHF&#39;</span><span class="p">]:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">scfgrad</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">ref_wfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ref_wfn</span></div>


<div class="viewcode-block" id="run_libfock"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_libfock">[docs]</a><span class="k">def</span> <span class="nf">run_libfock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a calculation through libfock, namely RCPHF,</span>
<span class="sd">    RCIS, RTDHF, RTDA, and RTDDFT.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cphf&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RCPHF&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cis&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RCIS&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tdhf&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RTDHF&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cpks&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RCPKS&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tda&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RTDA&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tddft&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;RTDDFT&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">libfock_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">libfock</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">libfock_wfn</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">libfock_wfn</span></div>


<div class="viewcode-block" id="run_mcscf"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_mcscf">[docs]</a><span class="k">def</span> <span class="nf">run_mcscf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a multiconfigurational self-consistent-field calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure the molecule the user provided is the active one</span>
    <span class="n">mcscf_molecule</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">())</span>
    <span class="n">mcscf_molecule</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;ref_wfn&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;It is not possible to pass run_mcscf a reference wavefunction&quot;</span><span class="p">)</span>
    <span class="n">new_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">new_wavefunction</span><span class="p">(</span><span class="n">mcscf_molecule</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;BASIS&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">psi4</span><span class="o">.</span><span class="n">mcscf</span><span class="p">(</span><span class="n">new_wfn</span><span class="p">)</span></div>


<div class="viewcode-block" id="run_dfmp2_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfmp2_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_dfmp2_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a DFMP2 gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_MP2&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>  <span class="c1"># yes, this really must be global, not local to SCF</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;DF-MP2 gradients need DF-SCF reference.&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">dfmp2_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">compute_gradient</span><span class="p">()</span>
    <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfmp2_wfn</span></div>


<div class="viewcode-block" id="run_ccenergy"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_ccenergy">[docs]</a><span class="k">def</span> <span class="nf">run_ccenergy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a CCSD, CC2, and CC3 calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(at)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCHBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_AT&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cc2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cc3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CC3&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
    <span class="c1"># Call a plain energy(&#39;ccenergy&#39;) and have full control over options, incl. wfn</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccenergy&#39;</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Bypass routine scf if user did something special to get it to converge</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="c1"># Obtain semicanonical orbitals</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">((</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ccsd(t)&#39;</span><span class="p">,</span> <span class="s1">&#39;ccsd(at)&#39;</span><span class="p">,</span> <span class="s1">&#39;cc2&#39;</span><span class="p">,</span> <span class="s1">&#39;cc3&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-cc3&#39;</span><span class="p">])</span> <span class="ow">or</span>
              <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;SEMICANONICAL&#39;</span><span class="p">)):</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;RUN_CCTRANSORT&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cctransort</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">transqt2</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">ccsort</span><span class="p">()</span>

    <span class="n">ccwfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">ccenergy</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(at)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cchbar</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ccwfn</span></div>


<div class="viewcode-block" id="run_ccenergy_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_ccenergy_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_ccenergy_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a CCSD and CCSD(T) gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;GLOBALS&#39;</span><span class="p">,</span> <span class="s1">&#39;DERTYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;FREEZE_CORE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Frozen core is not available for the CC gradients.&#39;</span><span class="p">)</span>

    <span class="n">ccwfn</span> <span class="o">=</span> <span class="n">run_ccenergy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CCSD_T&#39;</span><span class="p">)</span>

        <span class="n">user_ref</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_ref</span> <span class="o">!=</span> <span class="s1">&#39;UHF&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Reference </span><span class="si">%s</span><span class="s1"> for CCSD(T) gradients is not available.&#39;</span> <span class="o">%</span> <span class="n">user_ref</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">cchbar</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>

    <span class="n">derivobj</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">Deriv</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">derivobj</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">derivobj</span>

    <span class="n">ccwfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ccwfn</span></div>


<div class="viewcode-block" id="run_bccd"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_bccd">[docs]</a><span class="k">def</span> <span class="nf">run_bccd</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a Brueckner CCD calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE_TEI&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bccd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD&#39;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bccd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_T&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRIPLES&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_T&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;proc.py:run_bccd name </span><span class="si">%s</span><span class="s2"> not recognized&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>


    <span class="c1"># Bypass routine scf if user did something special to get it to converge</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="c1"># Needed for (T).</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">):</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE_TEI&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCTRANSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE_TEI&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>

    <span class="n">bcc_iter_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s2">&quot;RUN_CCTRANSORT&quot;</span><span class="p">)):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">cctransort</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">transqt2</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">ccsort</span><span class="p">()</span>

        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">ccenergy</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;Brueckner convergence check: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">bool</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;BRUECKNER CONVERGED&#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;BRUECKNER CONVERGED&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="n">bcc_iter_cnt</span> <span class="o">&gt;=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;BCCD_MAXITER&#39;</span><span class="p">):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Warning! BCCD did not converge within the maximum number of iterations.&quot;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;You can increase the number of BCCD iterations by changing BCCD_MAXITER.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">bcc_iter_cnt</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bccd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cctriples</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ref_wfn</span></div>

<div class="viewcode-block" id="run_dft_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dft_property">[docs]</a><span class="k">def</span> <span class="nf">run_dft_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    DFT calculations. This is a simple alias to :py:func:`~proc.run_scf`</span>
<span class="sd">    since DFT properties all handled through oeprop.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">proc_util</span><span class="o">.</span><span class="n">dft_set_reference_local</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">)</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">oeprop_validator</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="n">scf_wfn</span> <span class="o">=</span> <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">scf_do_dipole</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Run OEProp</span>
    <span class="n">oe</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">scf_wfn</span><span class="p">)</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">oe</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scf_wfn</span></div>


<div class="viewcode-block" id="run_scf_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_scf_property">[docs]</a><span class="k">def</span> <span class="nf">run_scf_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    SCF calculations. This is a simple alias to :py:func:`~proc.run_scf`</span>
<span class="sd">    since SCF properties all handled through oeprop.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optstash</span> <span class="o">=</span> <span class="n">proc_util</span><span class="o">.</span><span class="n">scf_set_reference_local</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">)</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">oeprop_validator</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="n">scf_wfn</span> <span class="o">=</span> <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">scf_do_dipole</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Run OEProp</span>
    <span class="n">oe</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">scf_wfn</span><span class="p">)</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">oe</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scf_wfn</span></div>


<div class="viewcode-block" id="run_cc_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_cc_property">[docs]</a><span class="k">def</span> <span class="nf">run_cc_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    all CC property calculations.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;PROPERTY&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;R_CONVERGENCE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;R_CONVERGENCE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">])</span>

    <span class="n">oneel_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dipole&#39;</span><span class="p">,</span> <span class="s1">&#39;quadrupole&#39;</span><span class="p">]</span>
    <span class="n">twoel_properties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">response_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;polarizability&#39;</span><span class="p">,</span> <span class="s1">&#39;rotation&#39;</span><span class="p">,</span> <span class="s1">&#39;roa&#39;</span><span class="p">,</span> <span class="s1">&#39;roa_tensor&#39;</span><span class="p">]</span>
    <span class="n">excited_properties</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;oscillator_strength&#39;</span><span class="p">,</span> <span class="s1">&#39;rotational_strength&#39;</span><span class="p">]</span>

    <span class="n">one</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">two</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">excited</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">invalid</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="s1">&#39;properties&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">oneel_properties</span><span class="p">:</span>
                <span class="n">one</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">twoel_properties</span><span class="p">:</span>
                <span class="n">two</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">response_properties</span><span class="p">:</span>
                <span class="n">response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">excited_properties</span><span class="p">:</span>
                <span class="n">excited</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">invalid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The &quot;properties&quot; keyword is required with the property() function.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">n_one</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
    <span class="n">n_two</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
    <span class="n">n_response</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">n_excited</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">excited</span><span class="p">)</span>
    <span class="n">n_invalid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_invalid</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The following properties are not currently supported: </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">invalid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n_excited</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eom-ccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Excited state CC properties require EOM-CC2 or EOM-CCSD.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;eom-ccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">n_response</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Cannot (yet) compute response properties for excited states.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;roa&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
        <span class="c1"># Perform distributed roa job</span>
        <span class="n">run_roa</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span>  <span class="c1"># Don&#39;t do anything further</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n_one</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n_two</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n_response</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Computing both density- and response-based properties.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;cc2&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">]:</span>
        <span class="n">this_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="n">this_name</span><span class="p">)</span>
        <span class="n">ccwfn</span> <span class="o">=</span> <span class="n">run_ccenergy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="n">this_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CC property name </span><span class="si">%s</span><span class="s2"> not recognized&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="c1"># Need cchbar for everything</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">cchbar</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>

    <span class="c1"># Need ccdensity at this point only for density-based props</span>
    <span class="k">if</span> <span class="n">n_one</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n_two</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">cceom</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">cceom</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>

    <span class="c1"># Need ccresponse only for response-type props</span>
    <span class="k">if</span> <span class="n">n_response</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;RESPONSE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;PROPERTY&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">ccresponse</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>

    <span class="c1"># Excited-state transition properties</span>
    <span class="k">if</span> <span class="n">n_excited</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Unknown excited-state CC wave function.&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="c1"># Tight convergence unnecessary for transition properties</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span><span class="s1">&#39;R_CONVERGENCE&#39;</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span><span class="s1">&#39;R_CONVERGENCE&#39;</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span><span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cceom</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">(</span><span class="n">ccwfn</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s1">&#39;WFN&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;NONE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">revoke_global_option_changed</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ccwfn</span></div>


<div class="viewcode-block" id="run_dfmp2_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfmp2_property">[docs]</a><span class="k">def</span> <span class="nf">run_dfmp2_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a DFMP2 property calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_MP2&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;OPDM_RELAX&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;ONEPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;OPDM_RELAX&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>  <span class="c1"># local set insufficient b/c SCF option read in DFMP2</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;DF-MP2 properties need DF-SCF reference.&#39;</span><span class="p">)</span>

    <span class="n">properties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">)</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">oeprop_validator</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">scf_do_dipole</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">dfmp2_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">compute_gradient</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCS-MP2 TOTAL ENERGY&#39;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCS-MP2 CORRELATION ENERGY&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 TOTAL ENERGY&#39;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">))</span>

    <span class="c1"># Run OEProp</span>
    <span class="n">oe</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">dfmp2_wfn</span><span class="p">)</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="n">oe</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfmp2_wfn</span></div>


<div class="viewcode-block" id="run_detci_property"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_detci_property">[docs]</a><span class="k">def</span> <span class="nf">run_detci_property</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a configuration interaction calculation, namely FCI,</span>
<span class="sd">    CIn, MPn, and ZAPTn, computing properties.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;OPDM&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;TDM&#39;</span><span class="p">])</span>


    <span class="c1"># Find valid properties</span>
    <span class="n">valid_transition</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TRANSITION_DIPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;TRANSITION_QUADRUPOLE&#39;</span><span class="p">]</span>

    <span class="n">ci_prop</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ci_trans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">properties</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">prop</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">valid_transition</span><span class="p">:</span>
            <span class="n">ci_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ci_prop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>

    <span class="n">proc_util</span><span class="o">.</span><span class="n">oeprop_validator</span><span class="p">(</span><span class="n">ci_prop</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;OPDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci_trans</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;TDM&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>

    <span class="c1"># Compute</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mcscf&#39;</span><span class="p">,</span> <span class="s1">&#39;rasscf&#39;</span><span class="p">,</span> <span class="s1">&#39;casscf&#39;</span><span class="p">]:</span>
        <span class="n">ciwfn</span> <span class="o">=</span> <span class="n">run_detcas</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ciwfn</span> <span class="o">=</span> <span class="n">run_detci</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># All property names are just CI</span>
    <span class="k">if</span> <span class="s1">&#39;CI&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CI&#39;</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;avg_states&#39;</span><span class="p">)</span>
    <span class="n">nroots</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;num_roots&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">states</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nroots</span><span class="p">:</span>
        <span class="n">states</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nroots</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Run OEProp</span>
    <span class="n">oe</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">ciwfn</span><span class="p">)</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span> <span class="n">ci_prop</span><span class="p">:</span>
        <span class="n">oe</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="c1"># Compute &quot;the&quot; CI density</span>
    <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="c1"># If we have more than one root, compute all data</span>
    <span class="k">if</span> <span class="n">nroots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ===&gt; </span><span class="si">%s</span><span class="s2"> properties for all CI roots &lt;=== </span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
            <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ROOT </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">root</span><span class="p">))</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ciwfn</span><span class="o">.</span><span class="n">same_a_b_dens</span><span class="p">():</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Da_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Da_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Db_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
            <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="c1"># Transition density matrices</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nroots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci_trans</span><span class="p">):</span>
        <span class="n">oe</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tprop</span> <span class="ow">in</span> <span class="n">ci_trans</span><span class="p">:</span>
            <span class="n">oe</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tprop</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">   ===&gt; </span><span class="si">%s</span><span class="s2"> properties for all CI transition density matrices &lt;=== </span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">states</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">oe</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ROOT </span><span class="si">%d</span><span class="s2"> -&gt; ROOT </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">ciwfn</span><span class="o">.</span><span class="n">same_a_b_dens</span><span class="p">():</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Da_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Da_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
                <span class="n">oe</span><span class="o">.</span><span class="n">set_Db_mo</span><span class="p">(</span><span class="n">ciwfn</span><span class="o">.</span><span class="n">get_opdm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
            <span class="n">oe</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ciwfn</span></div>


<div class="viewcode-block" id="run_eom_cc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_eom_cc">[docs]</a><span class="k">def</span> <span class="nf">run_eom_cc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an EOM-CC calculation, namely EOM-CC2, EOM-CCSD, and EOM-CC3.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCHBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCHBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">run_ccenergy</span><span class="p">(</span><span class="s1">&#39;ccsd&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-cc2&#39;</span><span class="p">:</span>

        <span class="n">user_ref</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">!=</span> <span class="s1">&#39;UHF&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Reference </span><span class="si">%s</span><span class="s1"> for EOM-CC2 is not available.&#39;</span> <span class="o">%</span> <span class="n">user_ref</span><span class="p">)</span>

        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCHBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC2&#39;</span><span class="p">)</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">run_ccenergy</span><span class="p">(</span><span class="s1">&#39;cc2&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-cc3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCSORT&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCENERGY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCHBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCEOM&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CC3&#39;</span><span class="p">)</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">run_ccenergy</span><span class="p">(</span><span class="s1">&#39;cc3&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">cchbar</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">cceom</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ref_wfn</span></div>
    <span class="c1"># TODO ask if all these cc modules not actually changing wfn</span>


<div class="viewcode-block" id="run_eom_cc_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_eom_cc_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_eom_cc_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an EOM-CCSD gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;XI&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DERTYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;FIRST&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;eom-ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;EOM_CCSD&#39;</span><span class="p">)</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">run_eom_cc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;DGAS: proc.py:1599 hitting an undefined sequence&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Hit a wall in proc.py:1599&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;XI&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCLAMBDA&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;ZETA&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;CCDENSITY&#39;</span><span class="p">,</span> <span class="s1">&#39;XI&#39;</span><span class="p">,</span> <span class="s1">&#39;FALSE&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">cclambda</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">ccdensity</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">derivobj</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">Deriv</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">grad</span> <span class="o">=</span> <span class="n">derivobj</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">ref_wfn</span><span class="o">.</span><span class="n">set_gradient</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ref_wfn</span></div>


<div class="viewcode-block" id="run_adc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_adc">[docs]</a><span class="k">def</span> <span class="nf">run_adc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an algebraic diagrammatic construction calculation.</span>

<span class="sd">    .. caution:: Get rid of active molecule lines- should be handled in energy.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;ADC&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;ADC requires reference RHF&#39;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">psi4</span><span class="o">.</span><span class="n">adc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span></div>


<div class="viewcode-block" id="run_dft"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dft">[docs]</a><span class="k">def</span> <span class="nf">run_dft</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-functional-theory calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DFT_FUNCTIONAL&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_MP2&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">,</span> <span class="s1">&#39;MP2_OS_SCALE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">,</span> <span class="s1">&#39;MP2_SS_SCALE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DFT_FUNCTIONAL&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">user_ref</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;ROHF reference for DFT is not available.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;CUHF&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;CUHF reference for DFT is not available.&#39;</span><span class="p">)</span>

    <span class="n">scf_wfn</span> <span class="o">=</span> <span class="n">run_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ssuper</span> <span class="ow">in</span> <span class="n">superfunctional_list</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">ssuper</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">dfun</span> <span class="o">=</span> <span class="n">ssuper</span>

    <span class="k">if</span> <span class="n">dfun</span><span class="o">.</span><span class="n">is_c_hybrid</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">dfun</span><span class="o">.</span><span class="n">is_c_scs_hybrid</span><span class="p">():</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">,</span> <span class="s1">&#39;MP2_OS_SCALE&#39;</span><span class="p">,</span> <span class="n">dfun</span><span class="o">.</span><span class="n">c_os_alpha</span><span class="p">())</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">,</span> <span class="s1">&#39;MP2_SS_SCALE&#39;</span><span class="p">,</span> <span class="n">dfun</span><span class="o">.</span><span class="n">c_ss_alpha</span><span class="p">())</span>
            <span class="n">dfmp2_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">(</span><span class="n">scf_wfn</span><span class="p">)</span>
            <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">()</span>

            <span class="n">vdh</span> <span class="o">=</span> <span class="n">dfun</span><span class="o">.</span><span class="n">c_alpha</span><span class="p">()</span> <span class="o">*</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCS-MP2 CORRELATION ENERGY&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfmp2_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">(</span><span class="n">scf_wfn</span><span class="p">)</span>
            <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">()</span>
            <span class="n">vdh</span> <span class="o">=</span> <span class="n">dfun</span><span class="o">.</span><span class="n">c_alpha</span><span class="p">()</span> <span class="o">*</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">)</span>

        <span class="c1"># TODO: delete these variables, since they don&#39;t mean what they look to mean?</span>
        <span class="c1"># &#39;MP2 TOTAL ENERGY&#39;,</span>
        <span class="c1"># &#39;MP2 CORRELATION ENERGY&#39;,</span>
        <span class="c1"># &#39;MP2 SAME-SPIN CORRELATION ENERGY&#39;]</span>

        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;DOUBLE-HYBRID CORRECTION ENERGY&#39;</span><span class="p">,</span> <span class="n">vdh</span><span class="p">)</span>
        <span class="n">returnvalue</span> <span class="o">+=</span> <span class="n">vdh</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;DFT TOTAL ENERGY&#39;</span><span class="p">,</span> <span class="n">returnvalue</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">returnvalue</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    </span><span class="si">%s</span><span class="s1"> Energy Summary</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    -------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    DFT Reference Energy                  = </span><span class="si">%22.16lf</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">returnvalue</span> <span class="o">-</span> <span class="n">vdh</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    Scaled MP2 Correlation                = </span><span class="si">%22.16lf</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vdh</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    @Final double-hybrid DFT total energy = </span><span class="si">%22.16lf</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">returnvalue</span><span class="p">))</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">scf_wfn</span></div>


<div class="viewcode-block" id="run_dft_gradient"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dft_gradient">[docs]</a><span class="k">def</span> <span class="nf">run_dft_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-functional-theory gradient calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DFT_FUNCTIONAL&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DFT_FUNCTIONAL&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="n">user_ref</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;RHF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;RKS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;UHF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">,</span> <span class="s1">&#39;UKS&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;ROHF reference for DFT is not available.&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">user_ref</span> <span class="o">==</span> <span class="s1">&#39;CUHF&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;CUHF reference for DFT is not available.&#39;</span><span class="p">)</span>

    <span class="n">wfn</span> <span class="o">=</span> <span class="n">run_scf_gradient</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wfn</span></div>


<div class="viewcode-block" id="run_detci"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_detci">[docs]</a><span class="k">def</span> <span class="nf">run_detci</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a configuration interaction calculation, namely FCI,</span>
<span class="sd">    CIn, MPn, and ZAPTn.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX_NUM_VECS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;FCI&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;EX_LEVEL&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Reference </span><span class="si">%s</span><span class="s1"> for DETCI is not available.&#39;</span> <span class="o">%</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;zapt&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;ZAPTN&#39;</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">maxnvect</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX_NUM_VECS&#39;</span><span class="p">,</span> <span class="n">maxnvect</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">,</span> <span class="s1">&#39;mp2&#39;</span><span class="p">,</span> <span class="s1">&#39;mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;mp4&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp4&#39;</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">maxnvect</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MAX_NUM_VECS&#39;</span><span class="p">,</span> <span class="n">maxnvect</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MPN_ORDER_SAVE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="c1"># untested</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;CC&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;CC_EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fci&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;FCI&#39;</span><span class="p">,</span> <span class="s1">&#39;TRUE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cisd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cisdt&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;cisdtq&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ci&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;DETCI&#39;</span><span class="p">)</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;EX_LEVEL&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;detci&#39;</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">ci_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">detci</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ci_wfn</span></div>


<div class="viewcode-block" id="run_dfmp2"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dfmp2">[docs]</a><span class="k">def</span> <span class="nf">run_dfmp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a density-fitted MP2 calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;DF_BASIS_MP2&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;DFMP2&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;ROHF&quot;</span><span class="p">:</span>
        <span class="n">ref_wfn</span><span class="o">.</span><span class="n">semicanonicalize</span><span class="p">()</span>

    <span class="n">dfmp2_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dfmp2</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">dfmp2_wfn</span><span class="o">.</span><span class="n">compute_energy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;scs-mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCS-MP2 TOTAL ENERGY&#39;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCS-MP2 CORRELATION ENERGY&#39;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 TOTAL ENERGY&#39;</span><span class="p">))</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">))</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dfmp2_wfn</span></div>


<div class="viewcode-block" id="run_dmrgscf"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dmrgscf">[docs]</a><span class="k">def</span> <span class="nf">run_dmrgscf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an DMRG calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DMRG&#39;</span><span class="p">,</span> <span class="s1">&#39;DMRG_CASPT2_CALC&#39;</span><span class="p">])</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;CASPT2&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s2">&quot;DMRG&quot;</span><span class="p">,</span> <span class="s2">&quot;DMRG_CASPT2_CALC&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> 

    <span class="n">dmrg_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dmrg</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dmrg_wfn</span></div>


<div class="viewcode-block" id="run_dmrgci"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_dmrgci">[docs]</a><span class="k">def</span> <span class="nf">run_dmrgci</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an DMRG calculation.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;DMRG&#39;</span><span class="p">,</span> <span class="s1">&#39;DMRG_SCF_MAX_ITER&#39;</span><span class="p">])</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Ensure IWL files have been written</span>
    <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DMRG&#39;</span><span class="p">,</span> <span class="s1">&#39;DMRG_SCF_MAX_ITER&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">dmrg_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">dmrg</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>
    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">dmrg_wfn</span></div>


<div class="viewcode-block" id="run_psimrcc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_psimrcc">[docs]</a><span class="k">def</span> <span class="nf">run_psimrcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for a PSIMRCC computation</span>
<span class="sd">     using a reference from the MCSCF module</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mcscf_wfn</span> <span class="o">=</span> <span class="n">run_mcscf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">psimrcc_e</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">psimrcc</span><span class="p">(</span><span class="n">mcscf_wfn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mcscf_wfn</span></div>


<div class="viewcode-block" id="run_psimrcc_scf"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_psimrcc_scf">[docs]</a><span class="k">def</span> <span class="nf">run_psimrcc_scf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for a PSIMRCC computation</span>
<span class="sd">     using a reference from the SCF module</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">psimrcc_e</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">psimrcc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ref_wfn</span></div>


<div class="viewcode-block" id="run_sapt"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_sapt">[docs]</a><span class="k">def</span> <span class="nf">run_sapt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a SAPT calculation of any level.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="c1"># Get the molecule of interest</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;Warning! SAPT argument &quot;ref_wfn&quot; is only able to use molecule information.&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>
    <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>  <span class="c1"># make sure since mol from wfn, kwarg, or P::e</span>

    <span class="c1"># Shifting to C1 so we need to copy the active molecule</span>
    <span class="k">if</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;  SAPT does not make use of molecular symmetry, further calculations in C1 point group.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">reset_point_group</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_orientation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_com</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;SAPT requires requires </span><span class="se">\&quot;</span><span class="s1">reference rhf</span><span class="se">\&quot;</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="n">nfrag</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">nfragments</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nfrag</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;SAPT requires active molecule to have 2 fragments, not </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nfrag</span><span class="p">))</span>

    <span class="n">do_delta_mp2</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;dmp2&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>

    <span class="n">sapt_basis</span> <span class="o">=</span> <span class="s1">&#39;dimer&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;sapt_basis&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">sapt_basis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sapt_basis&#39;</span><span class="p">)</span>
    <span class="n">sapt_basis</span> <span class="o">=</span> <span class="n">sapt_basis</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;dimer&#39;</span><span class="p">:</span>
        <span class="n">monomerA</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
        <span class="n">monomerB</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;monomer&#39;</span><span class="p">:</span>
        <span class="n">monomerA</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
        <span class="n">monomerB</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>

    <span class="n">ri</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
    <span class="n">df_ints_io</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>
    <span class="c1"># inquire if above at all applies to dfmp2</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Dimer HF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;dimer&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">dimer_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">sapt_dimer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_delta_mp2</span><span class="p">:</span>
        <span class="n">select_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ref_wfn</span><span class="o">=</span><span class="n">dimer_wfn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mp2_corl_interaction_e</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;dimer&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;LOAD&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;dimer&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer A HF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerA_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerA</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_delta_mp2</span><span class="p">:</span>
        <span class="n">select_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ref_wfn</span><span class="o">=</span><span class="n">monomerA_wfn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mp2_corl_interaction_e</span> <span class="o">-=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sapt_basis</span> <span class="o">==</span> <span class="s1">&#39;dimer&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer B HF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerB_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerB</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">do_delta_mp2</span><span class="p">:</span>
        <span class="n">select_mp2</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ref_wfn</span><span class="o">=</span><span class="n">monomerB_wfn</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mp2_corl_interaction_e</span> <span class="o">-=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;MP2 CORRELATION ENERGY&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;SAPT MP2 CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">mp2_corl_interaction_e</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints_io</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERA</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERB</span><span class="p">,</span> <span class="s1">&#39;monomerB&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;D_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt0&#39;</span><span class="p">,</span> <span class="s1">&#39;ssapt0&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT0&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+(3)&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+(3)dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+3&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+3dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+(ccd)&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+(ccd)dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+(3)(ccd)&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+(3)(ccd)dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sapt2+3(ccd)&#39;</span><span class="p">,</span> <span class="s1">&#39;sapt2+3(ccd)dmp2&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">sapt</span><span class="p">(</span><span class="n">dimer_wfn</span><span class="p">,</span> <span class="n">monomerA_wfn</span><span class="p">,</span> <span class="n">monomerB_wfn</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">qcdb.psivardefs</span> <span class="kn">import</span> <span class="n">sapt_psivars</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">expand_psivars</span><span class="p">(</span><span class="n">sapt_psivars</span><span class="p">())</span>
    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ELST&#39;</span><span class="p">,</span> <span class="s1">&#39;EXCH&#39;</span><span class="p">,</span> <span class="s1">&#39;IND&#39;</span><span class="p">,</span> <span class="s1">&#39;DISP&#39;</span><span class="p">,</span> <span class="s1">&#39;TOTAL&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="n">term</span><span class="p">,</span> <span class="s1">&#39;ENERGY&#39;</span><span class="p">]),</span> 
            <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">term</span><span class="p">,</span> <span class="s1">&#39;ENERGY&#39;</span><span class="p">])))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SAPT TOTAL ENERGY&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">dimer_wfn</span></div>


<div class="viewcode-block" id="run_sapt_ct"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_sapt_ct">[docs]</a><span class="k">def</span> <span class="nf">run_sapt_ct</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a charge-transfer SAPT calcuation of any level.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="s1">&#39;ref_wfn&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning! Argument ref_wfn is not valid for sapt computations</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="c1"># Get the molecule of interest</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;Warning! SAPT argument &quot;ref_wfn&quot; is only able to use molecule information.&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>
    <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>  <span class="c1"># make sure since mol from wfn, kwarg, or P::e</span>

    <span class="c1"># Shifting to C1 so we need to copy the active molecule</span>
    <span class="k">if</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;  SAPT does not make use of molecular symmetry, further calculations in C1 point group.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">reset_point_group</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_orientation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_com</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;SAPT requires requires </span><span class="se">\&quot;</span><span class="s1">reference rhf</span><span class="se">\&quot;</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="n">nfrag</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">nfragments</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nfrag</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;SAPT requires active molecule to have 2 fragments, not </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nfrag</span><span class="p">))</span>

    <span class="n">monomerA</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">monomerA</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">monomerB</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">monomerB</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>
    <span class="n">monomerAm</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">monomerAm</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerAm&#39;</span><span class="p">)</span>
    <span class="n">monomerBm</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">extract_subsets</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">monomerBm</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;monomerBm&#39;</span><span class="p">)</span>

    <span class="n">ri</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span>
    <span class="n">df_ints_io</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">)</span>
    <span class="c1"># inquire if above at all applies to dfmp2</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Dimer HF&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>
    <span class="n">dimer_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">sapt_dimer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;LOAD&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerA&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer A HF (Dimer Basis)&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerA_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerA</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ri</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerB&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer B HF (Dimer Basis)&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerB_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerB</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="n">df_ints_io</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerAm&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer A HF (Monomer Basis)&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerAm_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerAm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;monomerBm&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer B HF (Monomer Basis)&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">monomerBm_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">monomerBm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">set_default_namespace</span><span class="p">(</span><span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;E_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;D_CONVERGENCE&#39;</span><span class="p">,</span> <span class="mf">10e-10</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt0-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT0&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+(3)-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+3-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+(ccd)-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+(3)(ccd)-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sapt2+3(ccd)-ct&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT_LEVEL&#39;</span><span class="p">,</span> <span class="s1">&#39;SAPT2+3&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_THIRD_ORDER&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SAPT&#39;</span><span class="p">,</span> <span class="s1">&#39;DO_CCD_DISP&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;SAPT Charge Transfer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Dimer Basis SAPT&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERA</span><span class="p">,</span> <span class="s1">&#39;monomerA&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERB</span><span class="p">,</span> <span class="s1">&#39;monomerB&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">sapt</span><span class="p">(</span><span class="n">dimer_wfn</span><span class="p">,</span> <span class="n">monomerA_wfn</span><span class="p">,</span> <span class="n">monomerB_wfn</span><span class="p">)</span>
    <span class="n">CTd</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SAPT CT ENERGY&#39;</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Monomer Basis SAPT&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERA</span><span class="p">,</span> <span class="s1">&#39;monomerAm&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">IO</span><span class="o">.</span><span class="n">change_file_namespace</span><span class="p">(</span><span class="n">p4const</span><span class="o">.</span><span class="n">PSIF_SAPT_MONOMERB</span><span class="p">,</span> <span class="s1">&#39;monomerBm&#39;</span><span class="p">,</span> <span class="s1">&#39;dimer&#39;</span><span class="p">)</span>
    <span class="n">e_sapt</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">sapt</span><span class="p">(</span><span class="n">dimer_wfn</span><span class="p">,</span> <span class="n">monomerAm_wfn</span><span class="p">,</span> <span class="n">monomerBm_wfn</span><span class="p">)</span>
    <span class="n">CTm</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SAPT CT ENERGY&#39;</span><span class="p">)</span>
    <span class="n">CT</span> <span class="o">=</span> <span class="n">CTd</span> <span class="o">-</span> <span class="n">CTm</span>

    <span class="n">units</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1000.0</span><span class="p">,</span> <span class="n">p4const</span><span class="o">.</span><span class="n">psi_hartree2kcalmol</span><span class="p">,</span> <span class="n">p4const</span><span class="o">.</span><span class="n">psi_hartree2kJmol</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    SAPT Charge Transfer Analysis</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;  ------------------------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    SAPT Induction (Dimer Basis)  </span><span class="si">%12.4lf</span><span class="s1"> [mEh] </span><span class="si">%12.4lf</span><span class="s1"> [kcal/mol] </span><span class="si">%12.4lf</span><span class="s1"> [kJ/mol]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">CTd</span> <span class="o">*</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    SAPT Induction (Monomer Basis)</span><span class="si">%12.4lf</span><span class="s1"> [mEh] </span><span class="si">%12.4lf</span><span class="s1"> [kcal/mol] </span><span class="si">%12.4lf</span><span class="s1"> [kJ/mol]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">CTm</span> <span class="o">*</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;    SAPT Charge Transfer          </span><span class="si">%12.4lf</span><span class="s1"> [mEh] </span><span class="si">%12.4lf</span><span class="s1"> [kcal/mol] </span><span class="si">%12.4lf</span><span class="s1"> [kJ/mol]</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="n">CT</span> <span class="o">*</span> <span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">units</span><span class="p">))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;SAPT CT ENERGY&#39;</span><span class="p">,</span> <span class="n">CT</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dimer_wfn</span></div>


<div class="viewcode-block" id="run_fisapt"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_fisapt">[docs]</a><span class="k">def</span> <span class="nf">run_fisapt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    an F/ISAPT0 computation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="c1"># Alter default algorithm</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="c1"># Get the molecule of interest</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;molecule&#39;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_molecule</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;Warning! FISAPT argument &quot;ref_wfn&quot; is only able to use molecule information.&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>
    <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>  <span class="c1"># make sure since mol from wfn, kwarg, or P::e</span>

    <span class="c1"># Shifting to C1 so we need to copy the active molecule</span>
    <span class="k">if</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;  FISAPT does not make use of molecular symmetry, further calculations in C1 point group.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span> <span class="o">=</span> <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">reset_point_group</span><span class="p">(</span><span class="s1">&#39;c1&#39;</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_orientation</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">fix_com</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sapt_dimer</span><span class="o">.</span><span class="n">update_geometry</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;FISAPT requires requires </span><span class="se">\&quot;</span><span class="s1">reference rhf</span><span class="se">\&quot;</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="n">molecule</span><span class="o">=</span><span class="n">sapt_dimer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">fisapt_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">fisapt</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fisapt_wfn</span></div>


<div class="viewcode-block" id="run_mrcc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_mrcc">[docs]</a><span class="k">def</span> <span class="nf">run_mrcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function that prepares environment and input files</span>
<span class="sd">    for a calculation calling Kallay&#39;s MRCC code.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check to see if we really need to run the SCF code.</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">vscf</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s1">&#39;SCF TOTAL ENERGY&#39;</span><span class="p">)</span>

    <span class="c1"># The parse_arbitrary_order method provides us the following information</span>
    <span class="c1"># We require that level be provided. level is a dictionary</span>
    <span class="c1"># of settings to be passed to psi4.mrcc</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s1">&#39;level&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;level parameter was not provided.&#39;</span><span class="p">)</span>

    <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>

    <span class="c1"># Fullname is the string we need to search for in iface</span>
    <span class="n">fullname</span> <span class="o">=</span> <span class="n">level</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span>

    <span class="c1"># User can provide &#39;keep&#39; to the method.</span>
    <span class="c1"># When provided, do not delete the MRCC scratch directory.</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s1">&#39;keep&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">keep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;keep&#39;</span><span class="p">]</span>

    <span class="c1"># Save current directory location</span>
    <span class="n">current_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># Find environment by merging PSIPATH and PATH environment variables</span>
    <span class="n">lenv</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PSIPATH&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">])</span> <span class="o">+</span> \
                <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATH&#39;</span><span class="p">),</span>
        <span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="c1">#   Filter out None values as subprocess will fault on them</span>
    <span class="n">lenv</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lenv</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">}</span>

    <span class="c1"># Need to move to the scratch directory, perferrably into a separate directory in that location</span>
    <span class="n">psi_io</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">IOManager</span><span class="o">.</span><span class="n">shared_object</span><span class="p">()</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">psi_io</span><span class="o">.</span><span class="n">get_default_path</span><span class="p">())</span>

    <span class="c1"># Make new directory specifically for mrcc</span>
    <span class="n">mrcc_tmpdir</span> <span class="o">=</span> <span class="s1">&#39;mrcc_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
    <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">mrcc_tmpdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>

    <span class="c1"># Check to see if directory already exists, if not, create.</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c1"># Move into the new directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c1"># Generate integrals and input file (dumps files to the current directory)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">mrcc_generate_input</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

    <span class="c1"># Load the fort.56 file</span>
    <span class="c1"># and dump a copy into the outfile</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">===== Begin fort.56 input for MRCC ======</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;fort.56&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;===== End   fort.56 input for MRCC ======</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Close psi4 output file and reopen with filehandle</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">close_outfile</span><span class="p">()</span>
    <span class="n">pathfill</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">outfile_name</span><span class="p">())</span> <span class="k">else</span> <span class="n">current_directory</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span>
    <span class="n">p4out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathfill</span> <span class="o">+</span> <span class="n">psi4</span><span class="o">.</span><span class="n">outfile_name</span><span class="p">(),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>

    <span class="c1"># Modify the environment:</span>
    <span class="c1">#    PGI Fortan prints warning to screen if STOP is used</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NO_STOP_MESSAGE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>

    <span class="c1"># Obtain user&#39;s OMP_NUM_THREADS so that we don&#39;t blow it away.</span>
    <span class="n">omp_num_threads_found</span> <span class="o">=</span> <span class="s1">&#39;OMP_NUM_THREADS&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span>
    <span class="k">if</span> <span class="n">omp_num_threads_found</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">omp_num_threads_user</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span>

    <span class="c1"># If the user provided MRCC_OMP_NUM_THREADS set the environ to it</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;MRCC&#39;</span><span class="p">,</span> <span class="s1">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;MRCC&#39;</span><span class="p">,</span> <span class="s1">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">))</span>

    <span class="c1"># Call dmrcc, directing all screen output to the output file</span>
    <span class="n">external_exe</span> <span class="o">=</span> <span class="s1">&#39;dmrcc&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">retcode</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">external_exe</span><span class="p">],</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">lenv</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Program </span><span class="si">%s</span><span class="s1"> not found in path or execution failed: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cfour_executable</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
        <span class="n">p4out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Program </span><span class="si">%s</span><span class="s1"> not found in path or execution failed: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">external_exe</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Program </span><span class="si">%s</span><span class="s2"> not found in path or execution failed: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">external_exe</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="n">c4out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">retcode</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">outfile_name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;stdout&#39;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p4out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">p4out</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">c4out</span> <span class="o">+=</span> <span class="n">data</span>

<span class="c1">#    try:</span>
<span class="c1">#        if psi4.outfile_name() == &#39;stdout&#39;:</span>
<span class="c1">#            retcode = subprocess.call(&#39;dmrcc&#39;, shell=True, env=lenv)</span>
<span class="c1">#        else:</span>
<span class="c1">#            retcode = subprocess.call(&#39;dmrcc &gt;&gt; &#39; + current_directory + &#39;/&#39; + psi4.outfile_name(), shell=True, env=lenv)</span>
<span class="c1">#</span>
<span class="c1">#        if retcode &lt; 0:</span>
<span class="c1">#            print(&#39;MRCC was terminated by signal %d&#39; % -retcode, file=sys.stderr)</span>
<span class="c1">#            exit(1)</span>
<span class="c1">#        elif retcode &gt; 0:</span>
<span class="c1">#            print(&#39;MRCC errored %d&#39; % retcode, file=sys.stderr)</span>
<span class="c1">#            exit(1)</span>
<span class="c1">#</span>
<span class="c1">#    except OSError as e:</span>
<span class="c1">#        print(&#39;Execution failed: %s&#39; % e, file=sys.stderr)</span>
<span class="c1">#        exit(1)</span>

    <span class="c1"># Restore the OMP_NUM_THREADS that the user set.</span>
    <span class="k">if</span> <span class="n">omp_num_threads_found</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;MRCC&#39;</span><span class="p">,</span> <span class="s1">&#39;MRCC_OMP_NUM_THREADS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;OMP_NUM_THREADS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">omp_num_threads_user</span>

    <span class="c1"># Scan iface file and grab the file energy.</span>
    <span class="n">ene</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;iface&#39;</span><span class="p">):</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ene</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;MP(2)&quot;</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;MP2&quot;</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="s1">&#39; TOTAL ENERGY&#39;</span><span class="p">,</span> <span class="n">ene</span><span class="p">)</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="s1">&#39; CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">ene</span> <span class="o">-</span> <span class="n">vscf</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="c1"># The last &#39;ene&#39; in iface is the one the user requested.</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT ENERGY&#39;</span><span class="p">,</span> <span class="n">ene</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s1">&#39;CURRENT CORRELATION ENERGY&#39;</span><span class="p">,</span> <span class="n">ene</span> <span class="o">-</span> <span class="n">vscf</span><span class="p">)</span>

    <span class="c1"># Load the iface file</span>
    <span class="n">iface</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;iface&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">iface_contents</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Delete mrcc tempdir</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Delete unless we&#39;re told not to</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">keep</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">mrcc_tmpdir</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Unable to remove MRCC temporary directory </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Return to submission directory and reopen output file</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">current_directory</span><span class="p">)</span>
    <span class="n">p4out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">reopen_outfile</span><span class="p">()</span>

    <span class="c1"># If we&#39;re told to keep the files or the user provided a path, do nothing.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">keep</span> <span class="o">!=</span> <span class="bp">False</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)):</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">MRCC scratch files have been kept.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;They can be found in &#39;</span> <span class="o">+</span> <span class="n">mrcc_tmpdir</span><span class="p">)</span>

    <span class="c1"># Dump iface contents to output</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">p4util</span><span class="o">.</span><span class="n">banner</span><span class="p">(</span><span class="s1">&#39;Full results from MRCC&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="n">iface_contents</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ref_wfn</span></div>


<div class="viewcode-block" id="run_fnodfcc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_fnodfcc">[docs]</a><span class="k">def</span> <span class="nf">run_fnodfcc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a DF-CCSD(T) computation.</span>

<span class="sd">    &gt;&gt;&gt; set cc_type df</span>
<span class="sd">    &gt;&gt;&gt; energy(&#39;fno-ccsd(t)&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">kwargs_lower</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># stash user options</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DFCC&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_CC&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_SCF&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DFCC&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c1"># throw an exception for open-shells</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Error: </span><span class="si">%s</span><span class="s2"> requires &#39;reference rhf&#39;.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_cholesky_from</span><span class="p">(</span><span class="n">mtd_type</span><span class="p">):</span>
        <span class="n">type_val</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_global_option</span><span class="p">(</span><span class="n">mtd_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_CC&#39;</span><span class="p">,</span> <span class="s1">&#39;CHOLESKY&#39;</span><span class="p">)</span>
            <span class="c1"># Alter default algorithm</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">)</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to CD.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_val</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_CC&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CHOLESKY&#39;</span><span class="p">:</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_BASIS_CC&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="c1"># Alter default algorithm</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>
                <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;    SCF Algorithm Type (re)set to DF.</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Invalid type &#39;</span><span class="si">%s</span><span class="s2">&#39; for DFCC&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">type_val</span><span class="p">)</span>

    <span class="c1"># triples?</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">set_cholesky_from</span><span class="p">(</span><span class="s1">&#39;CC_TYPE&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Invalid scf_type for DFCC.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># save DF or CD ints generated by SCF for use in CC</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;DF_INTS_IO&#39;</span><span class="p">,</span> <span class="s1">&#39;SAVE&#39;</span><span class="p">)</span>

    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">use_c1</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span><span class="o">.</span><span class="n">schoenflies_symbol</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;c1&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;  FNOCC does not make use of molecular symmetry: &quot;&quot;&quot;</span>
                                  <span class="sd">&quot;&quot;&quot;reference wavefunction must be C1.\n&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">fnocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">fnocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fnocc_wfn</span></div>


<div class="viewcode-block" id="run_fnocc"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_fnocc">[docs]</a><span class="k">def</span> <span class="nf">run_fnocc</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a QCISD(T), CCSD(T), MP2.5, MP3, and MP4 computation.</span>

<span class="sd">    &gt;&gt;&gt; energy(&#39;fno-ccsd(t)&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">kwargs_lower</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">level</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># stash user options:</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP2&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP3&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP4&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_MP4_TRIPLES&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DFCC&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DFCC&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c1"># which method?</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-ccsd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-ccsd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;qcisd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;qcisd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-qcisd&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-qcisd(t)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CCSD&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp2&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP2&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP3&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp4&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP4&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_MP4_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp4(sdq)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP4&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_MP4_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp4(sdq)&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP4&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_MP4_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP3&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp4&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_MP4&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_MP4_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;COMPUTE_TRIPLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="c1"># throw an exception for open-shells</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Error: </span><span class="si">%s</span><span class="s2"> requires &#39;reference rhf&#39;.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="c1"># Bypass the scf call if a reference wavefunction is given</span>
    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c1"># Ensure IWL files have been written</span>
        <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">fnocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">fnocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="c1"># set current correlation energy and total energy.  only need to treat mpn here.</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp3&#39;</span><span class="p">:</span>
        <span class="n">emp3</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP3 TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp3</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP3 CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp3</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp3&#39;</span><span class="p">:</span>
        <span class="n">emp3</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP3 TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp3</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP3 CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp3</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp4(sdq)&#39;</span><span class="p">:</span>
        <span class="n">emp4sdq</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4(SDQ) TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp4sdq</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4(SDQ) CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp4sdq</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp4sdq</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp4(sdq)&#39;</span><span class="p">:</span>
        <span class="n">emp4sdq</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4(SDQ) TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp4sdq</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4(SDQ) CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp4sdq</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp4sdq</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;fno-mp4&#39;</span><span class="p">:</span>
        <span class="n">emp4</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4 TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp4</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4 CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp4</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp4</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;mp4&#39;</span><span class="p">:</span>
        <span class="n">emp4</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4 TOTAL ENERGY&quot;</span><span class="p">)</span>
        <span class="n">cemp4</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;MP4 CORRELATION ENERGY&quot;</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT ENERGY&quot;</span><span class="p">,</span> <span class="n">emp4</span><span class="p">)</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT CORRELATION ENERGY&quot;</span><span class="p">,</span> <span class="n">cemp4</span><span class="p">)</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fnocc_wfn</span></div>


<div class="viewcode-block" id="run_cepa"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_cepa">[docs]</a><span class="k">def</span> <span class="nf">run_cepa</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    a cepa-like calculation.</span>

<span class="sd">    &gt;&gt;&gt; energy(&#39;cepa(1)&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">kwargs_lower</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># save user options</span>
    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;TRANSQT2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CEPA_NO_SINGLES&#39;</span><span class="p">])</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;RUN_CEPA&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c1"># what type of cepa?</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lccd&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-lccd&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;cepa(0)&#39;</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CEPA_NO_SINGLES&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cepa(0)&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(0)&#39;</span><span class="p">,</span> <span class="s1">&#39;lccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-lccsd&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;cepa(0)&#39;</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CEPA_NO_SINGLES&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cepa(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(1)&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;cepa(1)&#39;</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cepa(3)&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(3)&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;cepa(3)&#39;</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;acpf&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-acpf&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;acpf&#39;</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aqcc&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-aqcc&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;aqcc&#39;</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cisd&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cisd&#39;</span><span class="p">]:</span>
        <span class="n">cepa_level</span> <span class="o">=</span> <span class="s1">&#39;cisd&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Error: </span><span class="si">%s</span><span class="s2"> not implemented</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;CEPA_LEVEL&#39;</span><span class="p">,</span> <span class="n">cepa_level</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fno-lccd&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-lccsd&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(0)&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cepa(3)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fno-acpf&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-aqcc&#39;</span><span class="p">,</span> <span class="s1">&#39;fno-cisd&#39;</span><span class="p">]:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="c1"># throw an exception for open-shells</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;RHF&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Error: </span><span class="si">%s</span><span class="s2"> requires &#39;reference rhf&#39;.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;USE_DF_INTS&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c1"># Ensure IWL files have been written</span>
        <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="n">fnocc_wfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">fnocc</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="c1"># one-electron properties</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;DIPMOM&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cepa_level</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cepa(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;cepa(3)&#39;</span><span class="p">]:</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">    Error: one-electron properties not implemented for </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;FNOCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NAT_ORBS&#39;</span><span class="p">):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">print_out</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">    Error: one-electron properties not implemented for </span><span class="si">%s</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p4util</span><span class="o">.</span><span class="n">oeprop</span><span class="p">(</span><span class="n">fnocc_wfn</span><span class="p">,</span> <span class="s1">&#39;DIPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;QUADRUPOLE&#39;</span><span class="p">,</span> <span class="s1">&#39;MULLIKEN_CHARGES&#39;</span><span class="p">,</span> <span class="s1">&#39;NO_OCCUPATIONS&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">cepa_level</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fnocc_wfn</span></div>


<div class="viewcode-block" id="run_detcas"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_detcas">[docs]</a><span class="k">def</span> <span class="nf">run_detcas</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of PSI module calls for</span>
<span class="sd">    determinant-based multireference wavefuncations,</span>
<span class="sd">    namely CASSCF and RASSCF.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optstash</span> <span class="o">=</span> <span class="n">p4util</span><span class="o">.</span><span class="n">OptionsState</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="n">user_ref</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;REFERENCE&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user_ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHF&#39;</span><span class="p">,</span> <span class="s1">&#39;ROHF&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Reference </span><span class="si">%s</span><span class="s1"> for DETCI is not available.&#39;</span> <span class="o">%</span> <span class="n">user_ref</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;rasscf&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;RASSCF&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;casscf&#39;</span><span class="p">:</span>
        <span class="n">psi4</span><span class="o">.</span><span class="n">set_local_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;WFN&#39;</span><span class="p">,</span> <span class="s1">&#39;CASSCF&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Run DETCAS: Name </span><span class="si">%s</span><span class="s2"> not understood&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ref_wfn&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_wfn</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ref_wfn</span> <span class="o">=</span> <span class="n">scf_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># C1 certified</span>

    <span class="n">molecule</span> <span class="o">=</span> <span class="n">ref_wfn</span><span class="o">.</span><span class="n">molecule</span><span class="p">()</span>

    <span class="c1"># The DF case</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MCSCF_TYPE&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DF&#39;</span><span class="p">:</span>

        <span class="c1"># Do NOT set global options in general, this is a bit of a hack</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;DF&#39;</span><span class="p">)</span>

    <span class="c1"># The non-DF case</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">psi4</span><span class="o">.</span><span class="n">has_option_changed</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">):</span>
            <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">,</span> <span class="s1">&#39;PK&#39;</span><span class="p">)</span>

        <span class="c1"># Ensure IWL files have been written</span>
        <span class="n">proc_util</span><span class="o">.</span><span class="n">check_iwl_file_from_scf_type</span><span class="p">(</span><span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;SCF&#39;</span><span class="p">,</span> <span class="s1">&#39;SCF_TYPE&#39;</span><span class="p">),</span> <span class="n">ref_wfn</span><span class="p">)</span>

    <span class="c1"># Second-order SCF requires non-symmetric density matrix support</span>
    <span class="k">if</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_option</span><span class="p">(</span><span class="s1">&#39;DETCI&#39;</span><span class="p">,</span> <span class="s1">&#39;MCSCF_SO&#39;</span><span class="p">):</span>
        <span class="n">proc_util</span><span class="o">.</span><span class="n">check_non_symmetric_jk_density</span><span class="p">(</span><span class="s2">&quot;Second-order MCSCF&quot;</span><span class="p">)</span>

    <span class="n">ciwfn</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">detci</span><span class="p">(</span><span class="n">ref_wfn</span><span class="p">)</span>

    <span class="c1"># We always would like to print a little dipole information</span>
    <span class="n">oeprop</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">OEProp</span><span class="p">(</span><span class="n">ciwfn</span><span class="p">)</span>
    <span class="n">oeprop</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">oeprop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;DIPOLE&quot;</span><span class="p">)</span>
    <span class="n">oeprop</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE X&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; DIPOLE X&quot;</span><span class="p">))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE Y&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; DIPOLE Y&quot;</span><span class="p">))</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_variable</span><span class="p">(</span><span class="s2">&quot;CURRENT DIPOLE Z&quot;</span><span class="p">,</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; DIPOLE Z&quot;</span><span class="p">))</span>

    <span class="n">optstash</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ciwfn</span></div>


<div class="viewcode-block" id="run_efp"><a class="viewcode-back" href="../../autodoc_driver.html#procedures.proc.run_efp">[docs]</a><span class="k">def</span> <span class="nf">run_efp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function encoding sequence of module calls for a pure EFP</span>
<span class="sd">    computation (ignore any QM atoms).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialize library</span>
    <span class="n">efp</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">get_active_efp</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">efp</span><span class="o">.</span><span class="n">nfragments</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Method &#39;efp&#39; not available without EFP fragments in molecule&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="c1"># set options</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">set_global_option</span><span class="p">(</span><span class="s1">&#39;QMEFP&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>  <span class="c1"># apt to go haywire if set locally to efp</span>
    <span class="n">psi4</span><span class="o">.</span><span class="n">efp_set_options</span><span class="p">()</span>

    <span class="n">efp</span><span class="o">.</span><span class="n">print_out</span><span class="p">()</span>
    <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">efp</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">returnvalue</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="../../contents.html" title="Table Of Contents"
             >toc</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Psi4 [1.0.0 6a9a71b]</a> &raquo; </li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, The Psi4 Project.
      Last updated on Tuesday, 05 July 2016 02:54AM.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.
    </div>
    <!-- cloud_sptheme 1.3 -->
  </body>
</html>